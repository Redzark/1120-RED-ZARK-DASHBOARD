<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KVK 1120 Emergency Mode</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ (í™”ë©´ì´ ì•ˆ ë³´ì´ëŠ” ë¬¸ì œ ë°©ì§€) */
        body { 
            background-color: #0f1219; 
            color: #ffffff; 
            font-family: sans-serif; 
            text-align: center; 
            margin: 0; padding: 20px; 
        }
        h1 { color: #ffb347; margin-bottom: 5px; }
        
        /* ë¡œë”©/ì—ëŸ¬ ë©”ì‹œì§€ ë°•ìŠ¤ */
        #status-msg {
            padding: 10px; border: 1px solid #444; margin: 10px auto;
            max-width: 600px; background: #222; color: #aaa;
        }
        .error-mode { background: #ff5252 !important; color: white !important; font-weight: bold; }

        /* ì»¨í…Œì´ë„ˆ */
        .container { max-width: 700px; margin: 20px auto; display: flex; flex-direction: column; gap: 15px; }

        /* ëŒ€ì‹œë³´ë“œ ì¹´ë“œ */
        .dash-row { display: flex; gap: 10px; flex-wrap: wrap; }
        .card { flex: 1; min-width: 280px; background: #1e2330; padding: 15px; border-radius: 8px; border: 1px solid #444; text-align: left; }
        .card-title { font-weight: bold; border-bottom: 1px solid #555; padding-bottom: 5px; margin-bottom: 10px; display: block; }
        
        /* ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .section-box { background: #1e2330; border: 1px solid #333; border-radius: 8px; padding: 10px; text-align: left; }
        .sec-title { color: #ffb347; font-weight: bold; padding: 10px; border-bottom: 1px solid #444; }
        .list-item { background: rgba(0,0,0,0.3); padding: 10px; margin: 5px 0; border-radius: 4px; display: flex; justify-content: space-between; font-size: 0.9em; }
        .list-item.active { border: 1px solid #ffb347; background: rgba(255, 179, 71, 0.1); }
        .badge { padding: 2px 6px; border-radius: 4px; font-size: 0.8em; background: #333; }
        .badge.next { background: #ffb347; color: black; }

        /* íƒ€ì´ë¨¸ ë°•ìŠ¤ */
        .next-box { background: #2d3342; text-align: center; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .timer-text { font-size: 1.5em; font-weight: bold; font-family: monospace; display: block; margin-top: 5px; }
    </style>
</head>
<body>

    <h1>KVK 1120 COMMAND CENTER</h1>
    <div id="status-msg">System Loading...</div>

    <div class="container">
        
        <div class="dash-row">
            <div class="card">
                <span class="card-title" style="color:#81c784">ğŸ¤ ì™¸êµ (Diplomacy)</span>
                <div>ğŸ”µ ì•„êµ°: #1121, #1122</div>
                <div style="margin-top:5px; color:#e57373">ğŸ”´ ì êµ°: #1130, #1131</div>
            </div>
            <div class="card">
                <span class="card-title" style="color:#ffb347">ğŸ“¢ ê³µì§€ (Notice)</span>
                <div>âš”ï¸ ëª©í‘œ: KVK 3ì²œë§Œ í‚¬ ë‹¬ì„±</div>
                <div>ğŸšœ ì±„ì§‘: Free (ì±„ì§‘í‚¬X)</div>
                <div>â›” ê³µì„±: ê¸ˆì§€ (City Hit X)</div>
            </div>
        </div>

        <div class="section-box">
            <div class="sec-title">ğŸš© ì£¼ìš” ì¼ì • (Milestones)</div>
            <div class="next-box" id="box-milestone" style="display:none">
                <div id="title-milestone" style="font-weight:bold">-</div>
                <span class="timer-text" id="timer-milestone">00:00:00</span>
            </div>
            <div id="list-milestone"></div>
        </div>

        <div class="section-box">
            <div class="sec-title" style="color:#4fc3f7">ğŸ›ï¸ ê³ ëŒ€ ìœ ì  (Ruins)</div>
            <div class="next-box" id="box-ruins" style="display:none">
                <div id="title-ruins" style="font-weight:bold">-</div>
                <span class="timer-text" id="timer-ruins">00:00:00</span>
            </div>
            <div id="list-ruins"></div>
        </div>

        <div class="section-box">
            <div class="sec-title" style="color:#ba68c8">ğŸ”¥ ì–´ë‘ ì˜ ì œë‹¨ (Altar)</div>
            <div class="next-box" id="box-altar" style="display:none">
                <div id="title-altar" style="font-weight:bold">-</div>
                <span class="timer-text" id="timer-altar">00:00:00</span>
            </div>
            <div id="list-altar"></div>
        </div>

    </div>

    <script>
        // ì˜¤ë¥˜ ì¡ëŠ” í•¨ìˆ˜
        function catchError(e) {
            const msgBox = document.getElementById('status-msg');
            msgBox.innerHTML = "âš ï¸ ì‹œìŠ¤í…œ ì˜¤ë¥˜ ë°œìƒ: " + e.message;
            msgBox.className = "error-mode";
            console.error(e);
        }

        // ë©”ì¸ ë¡œì§ ì‹¤í–‰
        try {
            // ë‚ ì§œ ì„¤ì •
            const config = {
                milestones: [
                    { t: "ìƒì–´ë²„ë¦° ì™•êµ­ ì˜¤í”ˆ", date: "2025-12-09T09:00:00" },
                    { t: "4ê´€ë¬¸ ì˜¤í”ˆ", date: "2025-12-13T12:00:00" },
                    { t: "5ê´€ë¬¸ ì˜¤í”ˆ", date: "2025-12-27T12:00:00" },
                    { t: "í‚¹ìŠ¤ëœë“œ (7ê´€ë¬¸)", date: "2026-01-08T12:00:00" },
                    { t: "KvK ì‹œì¦Œ ì¢…ë£Œ", date: "2026-01-28T09:00:00" }
                ],
                ruins: { start: "2025-12-17T09:00:00", interval: 40, count: 28 },
                altar: { start: "2025-12-20T09:00:00", interval: 86, count: 10 }
            };

            let targets = {};

            // ì‹œê°„ í¬ë§· (KST/UTC)
            function getClockHTML() {
                const now = new Date();
                const kst = now.toLocaleString('en-US', { timeZone: 'Asia/Seoul', hour12: false });
                const utc = now.toLocaleString('en-US', { timeZone: 'UTC', hour12: false });
                return `ğŸ‡°ğŸ‡· ${kst} (KST) <br> ğŸŒ ${utc} (UTC)`;
            }

            // ë‚¨ì€ ì‹œê°„ ê³„ì‚°
            function getDiff(d) {
                const total = Date.parse(d) - Date.parse(new Date());
                const s = Math.floor((total / 1000) % 60);
                const m = Math.floor((total / 1000 / 60) % 60);
                const h = Math.floor((total / (1000 * 60 * 60)) % 24);
                const d_day = Math.floor(total / (1000 * 60 * 60 * 24));
                return { total, d: d_day, h, m, s };
            }

            // ë°˜ë³µ ì¼ì • ìƒì„±
            function makeEvents(startStr, interval, count, name) {
                const list = [];
                const start = new Date(startStr);
                const now = new Date();
                
                if(isNaN(start)) throw new Error("ë‚ ì§œ í˜•ì‹ì´ ì˜ëª»ë¨: " + startStr);

                for(let i=0; i<count; i++) {
                    const d = new Date(start.getTime() + (i * interval * 3600000));
                    // 1ì‹œê°„ ì „ ì¼ì •ê¹Œì§€ í‘œì‹œ
                    if (d > now - 3600000) list.push({ t: `${name} #${i+1}`, date: d });
                }
                return list;
            }

            // ë Œë”ë§ í•¨ìˆ˜
            function renderList(type, dataList, listId, boxId, titleId, timerId) {
                const listEl = document.getElementById(listId);
                const boxEl = document.getElementById(boxId);
                const titleEl = document.getElementById(titleId);
                
                if(!dataList || dataList.length === 0) {
                    listEl.innerHTML = "<div style='padding:10px'>ì¼ì • ì¢…ë£Œ</div>";
                    return;
                }

                // ë‹¤ìŒ ì¼ì • íƒ€ê²Ÿ ì„¤ì •
                targets[type] = dataList[0].date;
                boxEl.style.display = 'block';
                titleEl.innerText = dataList[0].t;

                let html = "";
                dataList.forEach((item, idx) => {
                    const isNext = (idx === 0);
                    const timeStr = item.date.toLocaleString('en-US', {
                        timeZone: 'Asia/Seoul', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit', hour12:false
                    });
                    
                    html += `<div class="list-item ${isNext ? 'active' : ''}">
                        <div>${item.t} ${isNext ? '<span class="badge next">NEXT</span>' : ''}</div>
                        <div style="font-family:monospace">${timeStr}</div>
                    </div>`;
                });
                listEl.innerHTML = html;
            }

            // ì´ˆê¸°í™”
            function init() {
                // ì£¼ìš” ì¼ì • ë°ì´í„° ê°€ê³µ
                const now = new Date();
                let mileData = [];
                config.milestones.forEach(m => {
                    const d = new Date(m.date);
                    if(d > now - 86400000) mileData.push({ t: m.titleKr, date: d });
                });

                // ë Œë”ë§ ì‹¤í–‰
                renderList('milestone', mileData, 'list-milestone', 'box-milestone', 'title-milestone', 'timer-milestone');
                
                const ruinsData = makeEvents(config.ruins.start, config.ruins.interval, config.ruins.count, "ê³ ëŒ€ ìœ ì ");
                renderList('ruins', ruinsData, 'list-ruins', 'box-ruins', 'title-ruins', 'timer-ruins');

                const altarData = makeEvents(config.altar.start, config.altar.interval, config.altar.count, "ì–´ë‘ ì˜ ì œë‹¨");
                renderList('altar', altarData, 'list-altar', 'box-altar', 'title-altar', 'timer-altar');

                // ìƒíƒœ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
                document.getElementById('status-msg').innerHTML = getClockHTML();
            }

            // íƒ€ì´ë¨¸ ë£¨í”„
            function loop() {
                try {
                    // ì‹œê³„ ì—…ë°ì´íŠ¸
                    document.getElementById('status-msg').innerHTML = getClockHTML();

                    // ê° íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
                    ['milestone', 'ruins', 'altar'].forEach(key => {
                        const tgt = targets[key];
                        const el = document.getElementById('timer-' + key);
                        if(tgt && el) {
                            const diff = getDiff(tgt);
                            if(diff.total <= 0) {
                                el.innerText = "OPEN NOW!";
                                el.style.color = "#00e676";
                            } else {
                                const pad = (n) => n.toString().padStart(2, '0');
                                el.innerText = `${diff.d}d ${pad(diff.h)}:${pad(diff.m)}:${pad(diff.s)}`;
                                el.style.color = "white";
                            }
                        }
                    });
                } catch(e) { catchError(e); }
            }

            // ì‹¤í–‰ ì‹œì‘
            init();
            setInterval(loop, 1000);

        } catch (e) {
            catchError(e);
        }
    </script>
</body>
</html>
