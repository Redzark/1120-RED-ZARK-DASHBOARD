<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RoK KVK 1120 Command Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ============================
           ê¸°ë³¸ ìŠ¤íƒ€ì¼ (í™”ë©´ ê°•ì œ ì¶œë ¥ìš©)
           ============================ */
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0; padding: 20px;
            text-align: center;
        }

        /* ì—ëŸ¬ ë©”ì‹œì§€ ë°•ìŠ¤ (í‰ì†Œì—” ìˆ¨ê¹€) */
        #debug-console {
            display: none;
            background: #d32f2f; color: white;
            padding: 15px; margin-bottom: 20px;
            border-radius: 8px; text-align: left;
            font-family: monospace; font-size: 0.9em;
        }

        h1 { color: #ffb74d; margin-bottom: 10px; font-size: 1.5rem; }

        /* ì‹œê³„ */
        .main-clock {
            background: rgba(255,255,255,0.05);
            padding: 10px 20px; border-radius: 20px;
            display: inline-block; margin-bottom: 20px;
            font-family: 'Roboto Mono', monospace;
            border: 1px solid #333;
        }

        .container { max-width: 720px; margin: 0 auto; display: flex; flex-direction: column; gap: 15px; }

        /* ëŒ€ì‹œë³´ë“œ */
        .dashboard-grid { display: flex; gap: 10px; flex-wrap: wrap; }
        .dash-card { flex: 1; min-width: 280px; background: #1e1e1e; padding: 15px; border-radius: 8px; border: 1px solid #333; text-align: left; }
        .dash-head { font-weight: bold; border-bottom: 1px solid #444; padding-bottom: 8px; margin-bottom: 10px; }
        .info-row { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.9em; }
        
        /* ì•„ì½”ë””ì–¸ */
        details { background: #1e1e1e; border: 1px solid #333; border-radius: 8px; overflow: hidden; }
        details[open] { border-color: #555; }
        summary {
            padding: 15px; cursor: pointer; font-weight: bold;
            display: flex; justify-content: space-between; align-items: center;
            background: #252525; list-style: none; user-select: none;
        }
        summary::-webkit-details-marker { display: none; }
        summary::after { content: 'â–¼'; color: #888; font-size: 0.8em; }
        details[open] summary::after { transform: rotate(180deg); }

        /* ì„¹ì…˜ ì»¬ëŸ¬ */
        .sec-milestone summary { border-left: 5px solid #ef5350; }
        .sec-ruins summary { border-left: 5px solid #42a5f5; }
        .sec-altar summary { border-left: 5px solid #ab47bc; }

        /* ë‚´ë¶€ ì½˜í…ì¸  */
        .content-area { padding: 15px; }
        
        /* íƒ€ì´ë¨¸ ë°•ìŠ¤ */
        .timer-box { background: #151515; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #333; text-align: center; }
        .timer-title { font-weight: bold; color: #fff; font-size: 1.1em; }
        .timer-digits { font-family: 'Roboto Mono', monospace; font-size: 1.8em; font-weight: bold; margin-top: 5px; color: #fff; }
        
        /* ë¦¬ìŠ¤íŠ¸ */
        .list-item { 
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(255,255,255,0.03); padding: 10px; margin-bottom: 5px; border-radius: 6px;
        }
        .list-item.active { background: rgba(255, 183, 77, 0.15); border: 1px solid #ffb74d; }
        .item-left { text-align: left; }
        .item-right { text-align: right; font-family: 'Roboto Mono', monospace; font-size: 0.8em; color: #aaa; }
        
        /* ë°°ì§€ & ë²„íŠ¼ */
        .badge { font-size: 0.7em; padding: 2px 5px; border-radius: 4px; margin-left: 5px; vertical-align: middle; }
        .bg-gold { background: #ffb74d; color: black; }
        .btn-copy { background: none; border: 1px solid #666; color: #aaa; font-size: 0.7em; cursor: pointer; border-radius: 4px; margin-left: 10px; }
    </style>
</head>
<body>

    <div id="debug-console"></div>

    <h1>KVK 1120 COMMAND CENTER</h1>
    <div class="main-clock" id="main-clock">System Loading...</div>

    <div class="container">

        <div class="dashboard-grid">
            <div class="dash-card">
                <div class="dash-head" style="color:#66bb6a">ğŸ¤ ì™¸êµ (Diplomacy)</div>
                <div class="info-row"><span style="color:#66bb6a; font-weight:bold">ğŸ”µ Allies</span> <span>#1121, #1122</span></div>
                <div class="info-row"><span style="color:#ef5350; font-weight:bold">ğŸ”´ Enemy</span> <span>#1130, #1131</span></div>
            </div>
            <div class="dash-card">
                <div class="dash-head" style="color:#ffb74d">ğŸ“¢ ê³µì§€ (Notice)</div>
                <ul style="padding-left:20px; margin:0; font-size:0.9em; color:#ccc; line-height:1.6">
                    <li>âš”ï¸ <strong>Goal:</strong> 3ì²œë§Œ í‚¬ (30M Kills)</li>
                    <li>ğŸšœ <strong>Farming:</strong> ììœ  (Free)</li>
                    <li>â›” <strong>City Hit:</strong> ê¸ˆì§€ (No Zeroing)</li>
                </ul>
            </div>
        </div>

        <details class="sec-milestone" open>
            <summary>ğŸš© ì£¼ìš” ì¼ì • (Milestones)</summary>
            <div class="content-area">
                <div id="box-milestone" class="timer-box" style="display:none">
                    <div class="timer-title">
                        <span id="title-milestone">-</span>
                        <button class="btn-copy" onclick="copyTimer('milestone')">COPY</button>
                    </div>
                    <div class="timer-digits" id="timer-milestone">00:00:00</div>
                </div>
                <div id="list-milestone">Loading List...</div>
            </div>
        </details>

        <details class="sec-ruins">
            <summary>ğŸ›ï¸ ê³ ëŒ€ ìœ ì  (Ruins)</summary>
            <div class="content-area">
                <div id="box-ruins" class="timer-box" style="display:none">
                    <div class="timer-title">
                        <span id="title-ruins">-</span>
                        <button class="btn-copy" onclick="copyTimer('ruins')">COPY</button>
                    </div>
                    <div class="timer-digits" id="timer-ruins">00:00:00</div>
                </div>
                <div id="list-ruins">Loading List...</div>
            </div>
        </details>

        <details class="sec-altar">
            <summary>ğŸ”¥ ì–´ë‘ ì˜ ì œë‹¨ (Altar)</summary>
            <div class="content-area">
                <div id="box-altar" class="timer-box" style="display:none">
                    <div class="timer-title">
                        <span id="title-altar">-</span>
                        <button class="btn-copy" onclick="copyTimer('altar')">COPY</button>
                    </div>
                    <div class="timer-digits" id="timer-altar">00:00:00</div>
                </div>
                <div id="list-altar">Loading List...</div>
            </div>
        </details>

    </div>

    <script>
        // 1. ì—ëŸ¬ ìºì²˜ (í™”ë©´ì— ì—ëŸ¬ ë„ìš°ê¸°)
        function logError(msg) {
            const el = document.getElementById('debug-console');
            el.style.display = 'block';
            el.innerHTML += "âš ï¸ Error: " + msg + "<br>";
        }
        window.onerror = function(msg, url, line) {
            logError(msg + " (Line: " + line + ")");
            return false;
        };

        try {
            // ================= ì„¤ì • =================
            const config = {
                milestones: [
                    { kr: "ìƒì–´ë²„ë¦° ì™•êµ­ ì˜¤í”ˆ", en: "Lost Kingdom Opens", date: "2025-12-09T09:00:00" },
                    { kr: "4ê´€ë¬¸ ì˜¤í”ˆ", en: "Gate 4 Opens", date: "2025-12-13T12:00:00" },
                    { kr: "5ê´€ë¬¸ ì˜¤í”ˆ", en: "Gate 5 Opens", date: "2025-12-27T12:00:00" },
                    { kr: "í‚¹ìŠ¤ëœë“œ (7ê´€ë¬¸)", en: "Kingsland (Gate 7)", date: "2026-01-08T12:00:00" },
                    { kr: "KvK ì‹œì¦Œ ì¢…ë£Œ", en: "Season End", date: "2026-01-28T09:00:00" }
                ],
                ruins: { start: "2025-12-17T09:00:00", interval: 40, count: 28 },
                altar: { start: "2025-12-20T09:00:00", interval: 86, count: 10 }
            };

            let targets = {};

            // ìœ í‹¸: 0 ì±„ìš°ê¸°
            const pad = (n) => n.toString().padStart(2, '0');

            // ìœ í‹¸: ì‹œê°„ ë¬¸ìì—´ ìƒì„±
            function getTimeString(d) {
                if(isNaN(d)) return "Invalid Date";
                const kst = d.toLocaleString('en-US', { timeZone: 'Asia/Seoul', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit', hour12:false });
                const utc = d.toLocaleString('en-US', { timeZone: 'UTC', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit', hour12:false });
                return `ğŸ‡°ğŸ‡· ${kst}<br>ğŸŒ ${utc} (UTC)`;
            }

            // ìœ í‹¸: ë‚¨ì€ ì‹œê°„ ê³„ì‚°
            function getDiff(target) {
                const total = Date.parse(target) - Date.parse(new Date());
                const s = Math.floor((total / 1000) % 60);
                const m = Math.floor((total / 1000 / 60) % 60);
                const h = Math.floor((total / (1000 * 60 * 60)) % 24);
                const d = Math.floor(total / (1000 * 60 * 60 * 24));
                return { total, d, h, m, s };
            }

            // ë°ì´í„° ìƒì„±
            function createEvents(cfg, kr, en) {
                let list = [];
                let start = new Date(cfg.start);
                let now = new Date();
                
                for(let i=0; i<cfg.count; i++) {
                    let d = new Date(start.getTime() + (i * cfg.interval * 3600000));
                    if(d > now - 3600000) {
                        list.push({ kr: `${kr} (${i+1}ì°¨)`, en: `${en} #${i+1}`, date: d });
                    }
                }
                return list;
            }

            // ë Œë”ë§
            function render(type, events, listId, boxId, titleId) {
                const listEl = document.getElementById(listId);
                const boxEl = document.getElementById(boxId);
                const titleEl = document.getElementById(titleId);

                if(!events.length) {
                    listEl.innerHTML = "<div style='padding:10px'>All Done.</div>";
                    return;
                }

                // íƒ€ê²Ÿ ì„¤ì •
                targets[type] = events[0].date;
                boxEl.style.display = 'block';
                titleEl.innerText = `${events[0].kr} / ${events[0].en}`;

                let html = "";
                events.forEach((evt, idx) => {
                    const isNext = (idx === 0);
                    const activeClass = isNext ? 'active' : '';
                    const timeHTML = getTimeString(evt.date);
                    
                    html += `
                    <div class="list-item ${activeClass}">
                        <div class="item-left">
                            <div style="font-weight:bold">${evt.kr} ${isNext ? '<span class="badge bg-gold">NEXT</span>' : ''}</div>
                            <div style="font-size:0.8em; color:#888">${evt.en}</div>
                        </div>
                        <div class="item-right">${timeHTML}</div>
                    </div>`;
                });
                listEl.innerHTML = html;
            }

            // ì´ˆê¸°í™” ì‹¤í–‰
            const msData = config.milestones.map(m => ({ kr: m.kr, en: m.en, date: new Date(m.date) }));
            render('milestone', msData, 'list-milestone', 'box-milestone', 'title-milestone');

            const ruinsData = createEvents(config.ruins, "ê³ ëŒ€ ìœ ì ", "Ruins");
            render('ruins', ruinsData, 'list-ruins', 'box-ruins', 'title-ruins');

            const altarData = createEvents(config.altar, "ì–´ë‘ ì˜ ì œë‹¨", "Altar");
            render('altar', altarData, 'list-altar', 'box-altar', 'title-altar');

            // ë£¨í”„ í•¨ìˆ˜
            function loop() {
                const now = new Date();
                
                // ë©”ì¸ ì‹œê³„
                const clockEl = document.getElementById('main-clock');
                if(clockEl) {
                    const kst = now.toLocaleString('en-US', { timeZone: 'Asia/Seoul', hour12: false });
                    const utc = now.toLocaleString('en-US', { timeZone: 'UTC', hour12: false });
                    clockEl.innerHTML = `ğŸ‡°ğŸ‡· ${kst} (KST) &nbsp;|&nbsp; ğŸŒ ${utc} (UTC)`;
                }

                // íƒ€ì´ë¨¸
                ['milestone', 'ruins', 'altar'].forEach(key => {
                    const tgt = targets[key];
                    const el = document.getElementById('timer-' + key);
                    if(tgt && el) {
                        const t = getDiff(tgt);
                        if(t.total <= 0) {
                            el.innerText = "OPEN NOW!";
                            el.style.color = "#00e676";
                        } else {
                            el.innerText = `${t.d}d ${pad(t.h)}:${pad(t.m)}:${pad(t.s)}`;
                            el.style.color = "white";
                        }
                    }
                });
            }

            setInterval(loop, 1000);
            loop(); // ì¦‰ì‹œ ì‹¤í–‰

        } catch (e) {
            logError("ì´ˆê¸°í™” ì¤‘ ì¹˜ëª…ì  ì˜¤ë¥˜: " + e.message);
        }

        // ë³µì‚¬ ê¸°ëŠ¥ (ì•ˆì „í•˜ê²Œ ì²˜ë¦¬)
        function copyTimer(type) {
            try {
                const title = document.getElementById('title-' + type).innerText;
                const time = document.getElementById('timer-' + type).innerText;
                const text = `[1120 KVK] ${title} : ${time} left`;

                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(text).then(() => alert("Copied!\n" + text))
                    .catch(() => prompt("Ctrl+C to copy:", text));
                } else {
                    prompt("Ctrl+C to copy:", text);
                }
            } catch(e) {
                alert("Copy Failed");
            }
        }
    </script>
</body>
</html>
